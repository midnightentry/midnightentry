<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#050814" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>Notes</title>

  <!-- (Optional) Keep your existing OG tags here if you already added them -->
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icon-192.png" />

  <style>
    :root{ color-scheme: dark; }
    body{
      margin:0; min-height:100vh; display:grid; place-items:center;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      background:
        radial-gradient(900px 500px at 20% 20%, rgba(90,160,255,.35), transparent 60%),
        radial-gradient(900px 500px at 80% 30%, rgba(46,93,255,.25), transparent 55%),
        radial-gradient(900px 600px at 50% 90%, rgba(0,255,240,.12), transparent 60%),
        linear-gradient(180deg, #071022, #050814);
      color: rgba(255,255,255,.95);
    }
    .card{
      width:min(560px, 92vw);
      padding:30px 24px;
      border-radius:22px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      box-shadow:0 25px 60px rgba(0,0,0,.35);
      backdrop-filter: blur(12px);
    }
    h1{ margin:0 0 10px; font-size:28px; }
    p{ margin:0 0 18px; opacity:.9; line-height:1.45; }
    .btns{ display:grid; gap:12px; margin-top:14px; }
    button, a.btn{
      padding:14px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(255,255,255,.08);
      color:white;
      font-weight:900;
      cursor:pointer;
      text-decoration:none;
      text-align:center;
      transition:.18s ease;
      -webkit-tap-highlight-color: transparent;
    }
    button:hover, a.btn:hover{ background:rgba(255,255,255,.14); }

    /* PIN overlay */
    #lock{
      position:fixed; inset:0;
      display:grid; place-items:center;
      background: rgba(5,8,20,.95);
      z-index:9999;
      padding: 22px;
    }
    #lockCard{
      width:min(420px, 92vw);
      background:rgba(255,255,255,.06);
      border-radius:18px;
      padding:22px;
      border:1px solid rgba(255,255,255,.12);
      box-shadow:0 24px 60px rgba(0,0,0,.45);
    }
    #pin{
      width:100%;
      padding:14px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(255,255,255,.08);
      color:white;
      text-align:center;
      font-size:18px;
      letter-spacing:6px;
      outline:none;
    }
    #unlock{
      margin-top:12px;
      width:100%;
      padding:14px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(255,255,255,.10);
      color:white;
      font-weight:900;
      cursor:pointer;
    }
    #lockMsg{ margin-top:10px; font-size:13px; opacity:.85; }
  </style>
</head>

<body>
  <div id="lock">
    <div id="lockCard">
      <div style="font-weight:900; font-size:20px; margin-bottom:8px;">ðŸ”’ Access PIN</div>
      <input id="pin" placeholder="â€¢â€¢â€¢â€¢" inputmode="numeric" />
      <button id="unlock">Unlock</button>
      <div id="lockMsg"></div>
    </div>
  </div>

  <main class="card">
    <h1>Notes</h1>
    <p>Personal workspace.</p>

    <div class="btns">
      <a class="btn" id="chatBtn" href="#">Open</a>

      <button id="videoBtn" type="button">Video Call</button>
      <button id="audioBtn" type="button">Audio Call</button>
      <button id="copyCall" type="button">Copy Call Link</button>
      <button id="newCall" type="button">New Call Link</button>
    </div>
  </main>

  <script>
    // PIN = 1127 (SHA-256)
    const PIN_HASH = "7377a71607a8dabc029ab10e7a6a895b92e87762538b10ce8b10c4c9ddc74448";

    // âœ… Mobile-friendly Element entry:
    const MATRIX_LINK = "https://matrix.to/#/!QCDoDUrbQEiLoiTDVl:matrix.org";

    // Current Jitsi room
    let currentJitsiRoom = "";

    function isAndroid(){ return /Android/i.test(navigator.userAgent); }
    function isIOS(){ return /iPhone|iPad|iPod/i.test(navigator.userAgent); }

    async function sha256Hex(text){
      const data = new TextEncoder().encode(text);
      const buf = await crypto.subtle.digest("SHA-256", data);
      return [...new Uint8Array(buf)].map(b=>b.toString(16).padStart(2,"0")).join("");
    }

    function requireUnlock(){
      if (sessionStorage.getItem("unlocked") !== "1") {
        document.getElementById("lock").style.display = "grid";
        return false;
      }
      return true;
    }

    document.getElementById("unlock").addEventListener("click", async () => {
      const pin = (document.getElementById("pin").value || "").trim();
      const h = await sha256Hex(pin);
      if (h === PIN_HASH) {
        document.getElementById("lock").style.display = "none";
        sessionStorage.setItem("unlocked","1");
      } else {
        document.getElementById("lockMsg").textContent = "Wrong PIN";
      }
    });

    // Persist unlock for this session
    if (sessionStorage.getItem("unlocked") === "1") {
      document.getElementById("lock").style.display = "none";
    }

    // Open Element via matrix.to (works on mobile)
    document.getElementById("chatBtn").addEventListener("click", (e) => {
      e.preventDefault();
      if (!requireUnlock()) return;
      window.location.href = MATRIX_LINK;
    });

    // Jitsi room generator
    function generateRoom(){
      const bytes = new Uint8Array(8);
      crypto.getRandomValues(bytes);
      return Array.from(bytes, b => b.toString(16).padStart(2,"0")).join("");
    }
    function newCallRoom(){
      currentJitsiRoom = "notes-" + generateRoom();
    }
    newCallRoom();

    function jitsiWebUrl(audioOnly=false){
      const base = "https://meet.jit.si/" + currentJitsiRoom;
      return audioOnly ? (base + "#config.startWithVideoMuted=true") : base;
    }

    // Try app deep-link first on Android, then fallback to web
    function openJitsi(audioOnly=false){
      if (!requireUnlock()) return;

      const web = jitsiWebUrl(audioOnly);

      if (isAndroid()) {
        // Try open Jitsi app
        window.location.href = "jitsi-meet://" + currentJitsiRoom;
        // Fallback to web quickly
        setTimeout(() => { window.location.href = web; }, 900);
        return;
      }

      // iOS: open web (will prompt app if installed)
      window.location.href = web;
    }

    document.getElementById("videoBtn").addEventListener("click", () => openJitsi(false));
    document.getElementById("audioBtn").addEventListener("click", () => openJitsi(true));

    document.getElementById("copyCall").addEventListener("click", async () => {
      if (!requireUnlock()) return;
      try{
        await navigator.clipboard.writeText(jitsiWebUrl(false));
        alert("Copied");
      } catch {
        alert("Copy failed:\n\n" + jitsiWebUrl(false));
      }
    });

    document.getElementById("newCall").addEventListener("click", () => {
      if (!requireUnlock()) return;
      newCallRoom();
      alert("New call link created");
    });
  </script>
</body>
</html>
